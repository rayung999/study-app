## 1. 컴퓨터 시스템의 구조
컴퓨터 내부장치 : CPU, 메모리
컴퓨터 외부장치 : 디스크, 키보드, 마우스, 모니터, 네트워크 장치 등 

`입력` _input_ : 컴퓨터 내부로 데이터가 들어오는 것
`출력` _output_ : 컴퓨터 외부창치로 데이터가 나가는 것

### 입출력 :
키보드로부터 입력을 받아서 컴퓨터가 어떤 연산을 한 후 그 결과를 모니터에 출력

### 컨트롤러 :
컴퓨터 전체에 `CPU` 라는 중앙처리장치가 있듯이 `컨트롤러`는 각 하드웨어 장치마다 존재하면서 이들을 제어하는 작은 CPU 라고 할 수 있다.
![](https://velog.velcdn.com/images/rayung999/post/0d16c2eb-c7b0-468c-904a-b932a14c06fe/image.png)

### 커널 :
운영체제는 컴퓨터가 부팅되었을 때부터 항상 수행되면서 각종 자원들을 관리해야 하므로 항상 메모리에 올라가 있다.
- 운영체제 중 항상 메모리에 올라가 있는 부분은 전체 운영체제 중 핵심적인 부분에 한정되며, 이 부분을 _kernel_ 이라고 한다.

- - -

## 2. CPU 연산과 I/O 연산
입출력 장치들의 I/O연산은 `입출력 컨트롤러`가 담당하고, 
컴퓨터 내에서 수행되는 연산은 `메인 CPU`가 담당한다.
- 이때 입출력 장치와 메인 CPU는 동시 수행이 가능하다. 

> 각 장치마다 이를 제어하기 위해 설치된 장치 컨트롤러는 장치로부터 오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리를 가지고 있는데, 
이를 `로컬버퍼` _local buffer_ 라고 부른다.

- 디스크나 키보드 등에서 데이터를 읽어오는 경우, 우선 `로컬버퍼`에 데이터가 임시로 저장된 후 메모리에 전달하는데
- 이때 장치에서 `로컬버퍼`로 읽어오는 일은 `컨트롤러`가 담당한다.

__ex)__
1. 프로그램이 수행 중에 디스크에서 데이터를 읽어오라는 명령을 내림
2. 디스크 `컨트롤러`가 물리적인 디스크에서 내용을 읽는다.
3. 그 내용을 `로컬버퍼`에 저장한다. 
- => 원하는 데이터를 `로컬버퍼`로 다 읽어오고 난 후 장치에 있는 `컨트롤러`가 `인터럽트`를 발생시켜 CPU에 보고함으로써 메인 CPU에서 다음 일을 수행

### 인터럽트 : 
- `컨트롤러`들이 `CPU`의 서비스가 필요할 때 이를 통보하는 방법
- 키보드 입력 혹은 요청된 디스크 입출력 작업의 완료 등 `CPU`에 알려줄 필요가 있는 이벤트가 일어난 경우 `컨트롤러`가 발생시키는 것.

![](https://velog.velcdn.com/images/rayung999/post/13dc570f-3dbb-4c80-8dec-74ce96b6f6b2/image.png)

- - -

## 3. 인터럽트의 일반적 기능
 - 운영체제는 각종 하드웨어 및 소프트웨어 자원 관리뿐 아니라 사용자 프로그램에 필요한 서비스도 제공
 - 운영체제 `커널`에는 `인터럽트`가 들어왔을 때 해야 할 일이 미리 다 프로그래밍되어 그 코드가 보관되어 있다.
 <br> 
- `인터럽트`에는 _하드웨어 인터럽트_와 _소프트웨어 인터럽트_가 있는데
CPU의 서비스가 필요한 경우 CPU 옆에 있는 인터럽트 라인에 신호를 보내서 인터럽트가 발생했음을 알려주는 방식은 둘 다 동일.

>- `하드웨어 인터럽트` :
\- 컨트롤러 등 하드웨어 장치가 CPU의 인터럽트 라인을 세팅
<br> 
- `소프트웨어 인터럽트` : 
\- 소프트웨어가 CPU의 인터럽트 라인을 세팅

### 인터럽트 백터
인터럽트 종류마다 번호를 정해서, 번호에 따라 ___처리해야 할 코드___가 위치한 부분을 가리키고 있는 자료구조를 의미한다.
- 이때 실제 ___처리해야 할 코드___는
`인터럽트 처리루틴` _interrupt service routine_ 또는
`인터럽트 핸들러` _interrupt handler_ 라고 불리는 다른 곳에 정의된다.

### 소프트웨어 인터럽트
통상적으로 `인터럽트`라고 하면 `하드웨어 인터럽트`를 의미하고,
`소프트웨어 인터럽트`는 `트랩` _trap_ 이라는 용어로 주로 불린다.

__ex)__
- `예외상황` _exception_ : 
사용자 프로그램이 0으로 나누는 연산 등 비정상적인 작업을 시도하거나,
자신의 메모리 영역 바깥에 접근하려는 시도 등 권한이 없는 작업을 시도할 때
이에 대한 처리를 위해 발생시키는 `인터럽트`.

- `시스템 콜` _system call_ : 
사용자 프로그램이 운영체제 내부에 정의된 코드를 실행하고 싶을 때 
운영체제에 서비스를 요청하는 방법.


> `시스템 콜`이나 `예외상황`은 모두 
사용자 프로세스로부터 `CPU의 제어권`이 운영체제에 이양되어 처리되는데, 
이 과정에서 프로그램 코드가 직접 인터럽트 라인을 세팅하는 명령을 실행하여 
`인터럽트`를 발생시킨 후 제어권이 넘어가게 된다.

- - -

## 4. 인터럽트 핸들링
`인터럽트 핸들링` _interrupt handling_ : 
인터럽트가 발생한 경우에 처리해야 할 일의 절차를 의미한다.

- 프로그램이 실행되고 있을 때 `인터럽트`가 발생하면 
현재 `CPU`에서 실행 중인 명령의 메모리 주소를 포함해 몇 가지 부가적인 정보들을
먼저 저장한다.

- `CPU`에서 명령이 실행될 때는 `CPU` 내부에 있는 임시 기억 장치인 `레지스터` _register_ 에 데이터를 읽거나 쓰면서 작업을 한다.
- 이때 `인터럽트`가 발생해 새로운 명령을 실행하면 기존의 레지스터값들이 지워지게 되므로,
 `CPU` 내의 이러한 상태를 저장한 후에야 `인터럽트` 처리가 이루어진다.
 
### 프로세스 제어 블록 _Process Control Block_ : PCB
운영체제는 현재 시스템 내에서 실행되는 프로그램들을 관리하기 위해 `PCB`를 둔다.
- `PC`B는 각각의 프로그램마다 하나씩 존재하며 해당 프로그램이 실행 중이던 코드의 메모리 주소와 레지스터값, 하드웨어 상태등을 저장하고 있다.

1. 프로그램 실행
2. `인터럽트` 발생
3. 프로그램의 실행 상태를 `PCB`에 저장
4. CPU의 제어권이 `인터럽트 처리루틴`으로 넘어감
5. 인터럽트 처리 끝남 
6. 저장된 상태를 `PCB`로부터 `CPU`상에 복원
7. `인터럽트` 당하기 직전의 위치부터 실행

> 운영체제가 직접 CPU를 점유하는 경우는 인터럽트에 의하지 않고는 발생하지 않는다.

- - -

## 5. 입출력 구조
`입출력` I/O 이란 컴퓨터 시스템이 컴퓨터 외부의 입출력 장치들과 데이터를 주고 받는 것.

입출력 방식에 따라 `동기식 입출력`과 `비동기식 입출력`으로 나뉘어진다.

![](https://velog.velcdn.com/images/rayung999/post/7103b006-3909-4cf9-a1df-b55e06151ca6/image.png)


### 동기식 입출력
- 프로그램이 입출력 요청을 했을 때 _입출력 작업이 완료된 후에야 그 프로그램이 후속 작업을 수행_할 수 있는 방식
    - `CPU`는 `입출력` 연산이 끝날 때까지 `인터럽트`를 기다리며 자원을 낭비한다.
    - 입출력 장치에서 데이터를 읽어오는 등의 입출력 연산은 상대적으로 느리다.
    <br> 
    - `CPU`의 명령 수행 속도는 빠르다.
    <br>
- 일반적으로 프로그램이 `입출력`을 수행 중인 경우 `CPU`를 다른 프로그램에게 이양해 `CPU`가 계속 쉬지 않고 일할 수 있도록 관리한다.
	
    - 이를 관리하기 위해 운영체제는 프로그램을 몇 가지 상태로 나누고 `입출력` 중인 프로그램의 경우,
    `봉쇄 상태` _blocked state_ 로 전환시킨다.
    - `봉쇄 상태`의 프로그램에게는 `CPU`를 항당하지 않고, `CPU` 할당 시 곧바로 명령을 수행할 수 있는 프로그램에만 `CPU`를 할당한다.
    
하지만 이렇게 되면 동시다발의 입출력의 경우 의도치 않은 결과를 초래할 수 있다.
- 따라서 다수의 프로그램이 동시에 `입출력` 연산을 요청하는 경우,
`동기성` _synchronization_ 을 보장하기 위해 장치별로 `큐`  _queue_ 를 두어 요청한 순서대로 처리한다.

### 비동기식 입출력
- `입출력` 연산을 요청한 후에 연산이 끝나기를 기다리는 것이 아니라 `CPU의 제어권`을 `입출력` 연산을 호출한 그 프로그램에게 곧바로 다시 부여하는 방식

	
    - `CPU의 제어권`이 `입출력`을 요청한 프로세스에게 곧바로 다시 주어진다.
    - `입출력` 연산이 완료되는 것과 _무관하게 처리 가능한 작업_부터 처리한다.
  
> 일반적인 경우로는 운영체제에게 `입출력` 요청을 할 경우 해당 프로그램의 입출력이 완료될 때까지 그 프로그램을 봉쇄시키는 `동기식 입출력`을 사용한다. 
이때 운영체제는 장치별로 `입출력` 처리를 기다리는 프로세스를 줄 세워 관리함으로써 `동기성`을 보장하게 되는 것.

- - -